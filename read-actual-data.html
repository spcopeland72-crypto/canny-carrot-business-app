<!DOCTYPE html>
<html>
<head>
  <title>Read Actual Campaign Data</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
    .section { margin: 20px 0; padding: 15px; background: #252526; border-radius: 5px; }
    .valid { color: #4ec9b0; }
    .invalid { color: #f48771; }
    .warning { color: #dcdcaa; }
    pre { background: #1e1e1e; padding: 10px; border-radius: 3px; overflow-x: auto; }
    button { padding: 10px 20px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
    button:hover { background: #005a9e; }
  </style>
</head>
<body>
  <h1>üîç Read Actual Campaign Data from localStorage</h1>
  <button onclick="readData()">Read Data Now</button>
  <div id="output"></div>

  <script>
    const campaignTypes = ['double_stamps', 'bonus_reward', 'flash_sale', 'referral', 'birthday', 'happy_hour', 'loyalty_tier'];
    const campaignStatuses = ['draft', 'scheduled', 'active', 'paused', 'completed', 'cancelled'];

    function validateCampaign(item) {
      const isReward = item.isActive !== undefined || item.stampsRequired || item.costStamps;
      if (isReward) {
        return { valid: false, reason: 'Looks like a reward (has isActive/stampsRequired)' };
      }
      
      const hasCampaignType = item.type && campaignTypes.includes(item.type);
      const hasCampaignStatus = item.status && campaignStatuses.includes(item.status);
      
      if (!hasCampaignType) {
        return { valid: false, reason: `Missing or invalid 'type'. Has: "${item.type || 'undefined'}". Required: one of [${campaignTypes.join(', ')}]` };
      }
      
      if (!hasCampaignStatus) {
        return { valid: false, reason: `Missing or invalid 'status'. Has: "${item.status || 'undefined'}". Required: one of [${campaignStatuses.join(', ')}]` };
      }
      
      return { valid: true };
    }

    function readData() {
      const output = document.getElementById('output');
      output.innerHTML = '<div class="section"><h2>Reading data...</h2></div>';
      
      const campaignsKey = 'local_repo:campaigns';
      const rawData = localStorage.getItem(campaignsKey);
      
      let html = '';
      
      if (!rawData) {
        html += '<div class="section"><h2 class="invalid">‚ùå No campaigns data found</h2><p>Storage key: ' + campaignsKey + '</p></div>';
      } else {
        try {
          const allItems = JSON.parse(rawData);
          html += '<div class="section"><h2>üì¶ RAW STORAGE</h2><p>Found <strong>' + allItems.length + '</strong> item(s) in localStorage</p></div>';
          
          const validCampaigns = [];
          const invalidItems = [];
          
          allItems.forEach((item) => {
            const validation = validateCampaign(item);
            if (validation.valid) {
              validCampaigns.push(item);
            } else {
              invalidItems.push({ item, reason: validation.reason });
            }
          });
          
          html += '<div class="section">';
          html += '<h2 class="valid">‚úÖ VALID CAMPAIGNS (what app shows): ' + validCampaigns.length + '</h2>';
          html += '<h2 class="invalid">‚ùå INVALID/FILTERED OUT: ' + invalidItems.length + '</h2>';
          html += '</div>';
          
          // Look for "Stables bingo"
          const stablesBingoRaw = allItems.find(c => 
            c.name && c.name.toLowerCase().includes('stables bingo')
          );
          
          if (stablesBingoRaw) {
            html += '<div class="section">';
            html += '<h2 class="warning">üéØ FOUND "Stables bingo" in RAW storage</h2>';
            html += '<pre>' + JSON.stringify(stablesBingoRaw, null, 2) + '</pre>';
            
            const validation = validateCampaign(stablesBingoRaw);
            if (validation.valid) {
              html += '<p class="valid">‚úÖ VALIDATION: PASSED - Should appear in app</p>';
            } else {
              html += '<p class="invalid">‚ùå VALIDATION: FAILED - ' + validation.reason + '</p>';
              html += '<p class="warning">This is why it\'s missing from the app!</p>';
            }
            html += '</div>';
          } else {
            html += '<div class="section"><h2 class="invalid">‚ùå "Stables bingo" NOT FOUND in raw storage</h2></div>';
          }
          
          // Show valid campaigns
          if (validCampaigns.length > 0) {
            html += '<div class="section"><h2>üìã VALID CAMPAIGNS (what app displays)</h2>';
            validCampaigns.forEach((campaign, idx) => {
              html += '<div style="margin: 10px 0; padding: 10px; background: #1e1e1e; border-left: 3px solid #4ec9b0;">';
              html += '<strong>' + (idx + 1) + '. "' + (campaign.name || 'Unnamed') + '"</strong><br>';
              html += 'ID: ' + campaign.id + '<br>';
              html += 'Type: ' + campaign.type + '<br>';
              html += 'Status: ' + campaign.status + '<br>';
              html += 'Business ID: ' + campaign.businessId + '<br>';
              html += '</div>';
            });
            html += '</div>';
          }
          
          // Show invalid items
          if (invalidItems.length > 0) {
            html += '<div class="section"><h2 class="invalid">‚ùå INVALID ITEMS (filtered out by app)</h2>';
            invalidItems.forEach(({ item, reason }, idx) => {
              html += '<div style="margin: 10px 0; padding: 10px; background: #1e1e1e; border-left: 3px solid #f48771;">';
              html += '<strong>' + (idx + 1) + '. "' + (item.name || 'Unnamed') + '"</strong><br>';
              html += 'ID: ' + item.id + '<br>';
              html += '<span class="invalid">Reason: ' + reason + '</span><br>';
              html += '<pre style="font-size: 11px; margin-top: 5px;">' + JSON.stringify(item, null, 2) + '</pre>';
              html += '</div>';
            });
            html += '</div>';
          }
          
          // Business profile
          const businessProfileKey = 'local_repo:business_profile';
          const profileData = localStorage.getItem(businessProfileKey);
          if (profileData) {
            const profile = JSON.parse(profileData);
            html += '<div class="section">';
            html += '<h2>üè¢ BUSINESS PROFILE</h2>';
            html += '<p><strong>Name:</strong> ' + (profile.name || 'Unnamed') + '</p>';
            html += '<p><strong>Business ID:</strong> ' + profile.id + '</p>';
            
            const businessCampaigns = validCampaigns.filter(c => c.businessId === profile.id);
            html += '<p><strong>Valid campaigns for this business:</strong> ' + businessCampaigns.length + '</p>';
            html += '</div>';
          }
          
        } catch (error) {
          html += '<div class="section"><h2 class="invalid">‚ùå Error parsing data</h2>';
          html += '<p>' + error.message + '</p>';
          html += '<pre>' + rawData.substring(0, 1000) + '</pre></div>';
        }
      }
      
      output.innerHTML = html;
    }

    // Auto-run on load
    window.onload = readData;
  </script>
</body>
</html>





